<div #container>

  <!-- uncomment code below to debug component -->
  <!--<div>-->
    <!--limit: {{limit}} <br>-->
    <!--searchBoxValue: {{searchBoxValue}} <br>-->
  <!--</div>-->
  <!--<div>-->
  <!--1{{isValidated}}-->
  <!--2 {{valid() }}-->
  <!--</div>-->

  <div (click)="changeOpen()">
    <form *ngIf="!hasSearchInput; else hasSearchInputSection">
      <fieldset [disabled]="disabled">
        <div class="form-control" [ngClass]="{ 'placeholder' : (haveNotValue(value) && haveNotValue(internalValue)), 'btn-disable' : isOpenEditable()  }" #notSearchContaner>

          <span *ngIf="useMultiSelect; else simplePrintValue">
            {{ (joinDefaultMultiSelect() | essentialSelectTruncate:this:isOpen:userHasInputTextToSearchBeforeSelect:pipeNumber) || placeholder}}
          </span>

          <ng-template #simplePrintValue>
            {{ (printValue() | essentialSelectTruncate: this:searchBoxValue:isOpen:userHasInputTextToSearchBeforeSelect:pipeNumber) || placeholder }}
          </ng-template>

          <div class="trigger">
            <span class="icon-open" *ngIf="isOpenEditable()"></span>
            <span class="icon-closed" *ngIf="!isOpenEditable()"></span>
          </div>
        </div>
      </fieldset>
    </form>

    <ng-template #hasSearchInputSection>
      <form #selectForm="ngForm">
        <input placeholder="{{placeholder | essentialSelectTruncate:this:isOpen:userHasInputTextToSearchBeforeSelect:pipeNumber}}"
               class="form-control essential-form-control" name="input" autocomplete="off"
               #inputSelectPlaceholder
               [disabled]="disabled"
               [ngModel]="searchBoxValue | essentialSelectTruncate:this:isOpen:userHasInputTextToSearchBeforeSelect:pipeNumber"
               (ngModelChange)="onSearchInputChange($event)"
               [type]="searchInputType">
        <div class="trigger position-fix" *ngIf="showOpenCloseIcon">
          <span class="icon-open" *ngIf="isOpenEditable()"></span>
          <span class="icon-closed" *ngIf="!isOpenEditable()"></span>
        </div>
      </form>
    </ng-template>
  </div>

  <!-- print all rows -->
  <div class="wrapper {{wrapperClasses}}" #wrapper>
    <div class="selectbox_dropdown" *ngIf="isOpenEditable()" #selectDropdown [style.width]="getDropdownWidth()">

      <div *ngIf="useMultiSelect" class="multiselect_tools">
          <ul>
            <li>
            <div (click)="selectAll()" align="center">
              {{selectAllText}}
            </div>
            </li>
            <li>
              <div (click)="unselectAll()" align="center">
                {{unselectAllText}}
              </div>
            </li>
          </ul>

        <div class="hr-after-multiselect">
          <hr>
        </div>
      </div>

      <ul style="margin-top: 0">
        <li *ngIf="!disableUnselected" (click)="onUserOptionSelected(null)" [ngClass]="{ 'selected': haveNotValue(value), 'btn-disable' : isOpenEditable() }" style="padding-top: 10px">
          {{notSelectedText}}
        </li>
        <li *ngFor="let option of options | essentialSelectFilter:searchBoxValue:essentialsSelectFilter:useMultiSelect:this:userHasInputTextToSearchBeforeSelect | slice: 0:optionsDisplayLimit"
            (click)="onUserOptionSelected(option)"
            [ngClass]="{ 'selected' : isSelected(option) }">

          <span *ngIf="enabledRowClasses()">
            <span class="{{printRowClasses(option)}}"></span>
          </span>

          {{ printItemValue(option) }}
          <small class="display-as-block" *ngFor="let note of printItemValueAdditionalNotes(option)">
            {{note}}
          </small>
        </li>
      </ul>
    </div>
  </div>

</div>

<div *ngIf="isValidated && !valid()" class="invalid-field-container" [ngClass]="{'btn-disable' : isOpenEditable() }">
  <small class="b-hint b-hint-invalid"> !</small>
  <small class="form-invalid-color">
    {{ invalidText }}
  </small>
</div>

<!-- invisible container for length in pixels -->
<span class="rule" #containerLength></span>
